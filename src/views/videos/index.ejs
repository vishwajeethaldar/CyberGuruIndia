<%- include('../partials/head', { title }) %>
<%- include('../partials/navbar') %>
<%- include('../partials/alerts') %>

<main class="container py-4">
  <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 mb-4">
    <h1 class="h3 mb-0"><%= siteName %> Videos</h1>
    <form class="row g-2" method="GET" action="/videos">
      <div class="col-auto">
        <input type="text" class="form-control" name="q" placeholder="Search title..." value="<%= filters.q %>" />
      </div>
      <div class="col-auto">
        <select class="form-select" name="category">
          <option value="">All Categories</option>
          <% categories.forEach((category) => { %>
            <option value="<%= category._id %>" <%= filters.category === String(category._id) ? 'selected' : '' %>><%= category.name %></option>
          <% }) %>
        </select>
      </div>
      <div class="col-auto">
        <button class="btn btn-primary" type="submit">Filter</button>
      </div>
    </form>
  </div>

  <div class="row g-4">
    <% videos.forEach((video) => { %>
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm">
          <% if (video.thumbnailPath) { %>
            <img src="<%= video.thumbnailPath %>" class="card-img-top" alt="<%= video.title %> thumbnail" />
          <% } else { %>
            <img src="https://img.youtube.com/vi/<%= video.youtubeId %>/hqdefault.jpg" class="card-img-top" alt="<%= video.title %> thumbnail" />
          <% } %>
          <div class="card-body d-flex flex-column">
            <span class="badge text-bg-secondary align-self-start mb-2"><%= video.category.name %></span>
            <h2 class="h5"><a class="text-decoration-none" href="/videos/<%= video.slug %>"><%= video.title %></a></h2>
            <p class="text-muted small flex-grow-1"><%= stripMarkdown(video.description).slice(0, 120) %>...</p>
            <div class="d-flex justify-content-between align-items-center small text-muted">
              <div class="d-flex gap-3">
                <span>ğŸ‘ <%= video.likes %></span>
                <span>ğŸ‘ <%= video.dislikes %></span>
              </div>
              <button
                class="btn btn-sm btn-outline-secondary js-copy-share"
                type="button"
                data-share-url="<%= siteBaseUrl %>/videos/<%= video.slug %>"
                aria-label="Share video"
                title="Share"
              >ğŸ”—</button>
            </div>
          </div>
        </div>
      </div>
    <% }) %>

    <% if (!videos.length) { %>
      <div class="col-12">
        <div class="alert alert-info">No videos found for this filter.</div>
      </div>
    <% } %>
  </div>
</main>

<%- include('../partials/footer') %>
